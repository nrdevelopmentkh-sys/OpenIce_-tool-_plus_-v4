from telebot import TeleBot, types
import re

bot = TeleBot(config["bot_token"])

BAD_KEYWORDS = [
    "porn", "creampie", "sex", "xxx", "incest", 
    "nude", "hentai", "mother creampie", "18+", "adult"
]

APK_REGEX = r".*\.apk$"

@bot.message_handler(func=lambda m: True)
def guardian(message):

    text = message.text.lower() if message.text else ""

    # 1. keyword detection
    if any(k in text for k in BAD_KEYWORDS):
        bot.delete_message(message.chat.id, message.message_id)
        if config["group_protection"]["log_actions"]:
            bot.send_message(message.chat.id, f"⚠ ការពារ៖ ពាក្យបែបពន្លឺត្រូវបានលុប")

    # 2. APK detection
    if re.match(APK_REGEX, text):
        bot.delete_message(message.chat.id, message.message_id)
        bot.send_message(message.chat.id, "⚠ APK សង្ស័យត្រូវបានបញ្ឈប់")

    # 3. Flood detection
    if len(text) > 500:
        bot.delete_message(message.chat.id, message.message_id)

bot.polling()
